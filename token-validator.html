<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤ Form</title>
    <style>
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö */
        body {
            background-color: #0a0a0f; 
            color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
        }
        .status-card {
            background: rgba(15, 15, 20, 0.95); 
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 40px 32px;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #ef4444; /* ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Error */
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        p {
            color: #94a3b8;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        .loader {
            border: 4px solid #3b82f6; 
            border-top: 4px solid #f8fafc; 
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="status-card" id="statusCard">
        <div class="loader" id="loader"></div>
        <h1 id="statusTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...</h1>
        <p id="statusMessage">‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå</p>
    </div>

<script>
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const timestamp = params.get('timestamp');
    const formsId = params.get('formsId');
    const redirectUrl = params.get('redirectUrl');

    const EXPIRY_TIME_MS = 5 * 60 * 1000; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ
    
    // üö® ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Field ID ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö JS/Apps Script)
    const FIELD_MAP = {
      // Forms ID (URL ID) : { Token Field ID, Timestamp Field ID }
      '1FAIpQLSc34HgQvjAhusHI1fq9PKCLiymeBfMTvYxUosVTpz5nc8S_ww': { TOKEN: 'entry.2084859674', TIMESTAMP: 'entry.1465967331' }, // Studio 3
      '1FAIpQLScDVnvWKbCH9KVhDiXL6ruig1v7tk5YoiuFih-qktpYMpjBKA': { TOKEN: 'entry.736609822', TIMESTAMP: 'entry.827398466' }, // Studio 5
      '1FAIpQLSdzL91KTLiIvqxnEbmRTNXvIVytvWEIMTODjHkFOp5ReWJQDA': { TOKEN: 'entry.522425491', TIMESTAMP: 'entry.147300429' }, // Studio 4
      '1FAIpQLSeb1wq4YRhkEAZvP0-Vx3ENjiDUBX399QfWayuOKjZWw7J1tA': { TOKEN: 'entry.988532248', TIMESTAMP: 'entry.1166641522' }, // Studio 2
      '1FAIpQLScl6CyhhYHiC8CxjxWlHFDKqBsu5iOt12mo5v1-NhB5CGUlAw': { TOKEN: 'entry.1207357982', TIMESTAMP: 'entry.25177657' }  // Studio 1
    };

    function validateToken() {
        const currentTime = Date.now();
        const tokenCreationTime = parseInt(timestamp);
        const config = FIELD_MAP[formsId];

        document.getElementById('loader').style.display = 'none';
        document.getElementById('statusTitle').style.color = '#f8fafc'; // Reset color

        // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Token, Timestamp ‡πÅ‡∏•‡∏∞ Forms ID ‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå Form ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå)
        if (!token || !timestamp || !formsId || isNaN(tokenCreationTime) || !config) {
            document.getElementById('statusTitle').innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò';
            document.getElementById('statusMessage').innerText = '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á';
            document.getElementById('statusTitle').style.color = '#ef4444'; // ‡πÅ‡∏î‡∏á
            return;
        }

        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á Token (5 ‡∏ô‡∏≤‡∏ó‡∏µ)
        if (currentTime - tokenCreationTime > EXPIRY_TIME_MS) {
            document.getElementById('statusTitle').innerText = '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
            document.getElementById('statusMessage').innerText = '‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Form ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Studio ‡∏´‡∏•‡∏±‡∏Å';
            document.getElementById('statusTitle').style.color = '#f97316'; // ‡∏™‡πâ‡∏°
            return;
        }
        
        // 3. ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: Redirect ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Form ‡∏à‡∏£‡∏¥‡∏á (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ö Token/Timestamp ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)
        document.getElementById('statusTitle').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á...';
        document.getElementById('statusMessage').innerText = '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Form ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ';
        document.getElementById('statusTitle').style.color = '#10b981'; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        document.getElementById('loader').style.display = 'block';

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Form Response ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const finalFormUrl = `${decodeURIComponent(redirectUrl)}?entry.${config.TOKEN}=${token}&entry.${config.TIMESTAMP}=${timestamp}`;
        
        // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á Redirect ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        setTimeout(() => {
             // üí° Note: ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ window.location.replace ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ History ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
             window.location.replace(finalFormUrl);
        }, 500); 
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    document.getElementById('loader').style.display = 'block';
    validateToken();
</script>
</body>
</html>
